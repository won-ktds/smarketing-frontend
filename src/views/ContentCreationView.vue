<template>
  <v-container fluid class="pa-4">
    <v-row>
      <v-col cols="12">
        <v-card elevation="2">
          <v-card-title class="text-h6 pa-4">
            <v-icon class="mr-2" color="primary">mdi-pencil-plus</v-icon>
            AI ÏΩòÌÖêÏ∏† ÏÉùÏÑ±
          </v-card-title>
          
          <v-divider />
          
          <v-card-text class="pa-4">
            <v-stepper
              v-model="currentStep"
              :items="stepperItems"
              alt-labels
            >
              <!-- Stepper WindowÎ°ú Í∞Å Îã®Í≥Ñ Íµ¨ÌòÑ -->
              <v-stepper-window>
                
                <!-- Step 1: ÏΩòÌÖêÏ∏† ÌÉÄÏûÖ ÏÑ†ÌÉù -->
                <v-stepper-window-item value="1">
                  <v-card class="pa-4" flat>
                    <h3 class="text-h6 mb-4">Ïñ¥Îñ§ ÏΩòÌÖêÏ∏†Î•º ÎßåÎì§ÍπåÏöî?</h3>
                    
                    <v-row>
                      <v-col cols="12" md="6">
                        <v-card
                          :class="['content-type-card', { 'selected': contentData.type === 'SNS_POST' }]"
                          @click="contentData.type = 'SNS_POST'"
                          hover
                        >
                          <v-card-text class="text-center pa-6">
                            <v-icon size="48" color="pink" class="mb-3">mdi-instagram</v-icon>
                            <h4 class="text-h6 mb-2">SNS Í≤åÏãúÎ¨º</h4>
                            <p class="text-body-2">Ïù∏Ïä§ÌÉÄÍ∑∏Îû® & Î∏îÎ°úÍ∑∏Ïö© Í≤åÏãúÎ¨º</p>
                          </v-card-text>
                        </v-card>
                      </v-col>
                      
                      <v-col cols="12" md="6">
                        <v-card
                          :class="['content-type-card', { 'selected': contentData.type === 'POSTER' }]"
                          @click="contentData.type = 'POSTER'"
                          hover
                        >
                          <v-card-text class="text-center pa-6">
                            <v-icon size="48" color="purple" class="mb-3">mdi-image</v-icon>
                            <h4 class="text-h6 mb-2">ÌôçÎ≥¥ Ìè¨Ïä§ÌÑ∞</h4>
                            <p class="text-body-2">Îß§Ïû• Í≤åÏãúÏö© Ìè¨Ïä§ÌÑ∞</p>
                          </v-card-text>
                        </v-card>
                      </v-col>
                    </v-row>
                  </v-card>
                </v-stepper-window-item>

                <!-- Step 2: ÌôçÎ≥¥ ÎåÄÏÉÅ ÏÑ†ÌÉù -->
                <v-stepper-window-item value="2">
                  <v-card class="pa-4" flat>
                    <h3 class="text-h6 mb-4">Î¨¥ÏóáÏùÑ ÌôçÎ≥¥Ìï†ÍπåÏöî?</h3>
                    
                    <v-radio-group v-model="contentData.target">
                      <v-radio label="üçú Î©îÎâ¥ ÌôçÎ≥¥" value="menu" />
                      <v-radio label="üè™ Îß§Ïû• ÏÜåÍ∞ú" value="store" />
                      <v-radio label="üéâ Ïù¥Î≤§Ìä∏ ÌôçÎ≥¥" value="event" />
                    </v-radio-group>
                    
                    <!-- Î©îÎâ¥ ÏÑ†ÌÉù -->
                    <v-select
                      v-if="contentData.target === 'menu'"
                      v-model="contentData.selectedMenu"
                      label="ÌôçÎ≥¥Ìï† Î©îÎâ¥ ÏÑ†ÌÉù"
                      variant="outlined"
                      :items="menuOptions"
                      item-title="text"
                      item-value="value"
                      class="mt-4"
                    />
                    
                    <!-- Ïù¥Î≤§Ìä∏ ÏûÖÎ†• -->
                    <v-text-field
                      v-if="contentData.target === 'event'"
                      v-model="contentData.eventName"
                      label="Ïù¥Î≤§Ìä∏Î™Ö"
                      variant="outlined"
                      placeholder="Ïòà: Ïã†Î©îÎâ¥ Ï∂úÏãú Ïù¥Î≤§Ìä∏"
                      class="mt-4"
                    />
                  </v-card>
                </v-stepper-window-item>

                <!-- Step 3: Ïù¥ÎØ∏ÏßÄ ÏóÖÎ°úÎìú -->
                <v-stepper-window-item value="3">
                  <v-card class="pa-4" flat>
                    <h3 class="text-h6 mb-4">Ïù¥ÎØ∏ÏßÄÎ•º ÏóÖÎ°úÎìúÌïòÏÑ∏Ïöî</h3>
                    
                    <v-file-input
                      v-model="contentData.images"
                      label="Ïù¥ÎØ∏ÏßÄ ÌååÏùº"
                      variant="outlined"
                      accept="image/*"
                      multiple
                      prepend-icon="mdi-camera"
                      show-size
                      chips
                      class="mb-4"
                    />
                    
                    <!-- Ïù¥ÎØ∏ÏßÄ ÎØ∏Î¶¨Î≥¥Í∏∞ -->
                    <v-row v-if="imagePreviewUrls.length > 0">
                      <v-col
                        v-for="(url, index) in imagePreviewUrls"
                        :key="index"
                        cols="6"
                        md="3"
                      >
                        <v-card class="pa-2">
                          <v-img :src="url" height="100" cover />
                        </v-card>
                      </v-col>
                    </v-row>
                  </v-card>
                </v-stepper-window-item>

                <!-- Step 4: ÏÑ∏Î∂Ä ÏòµÏÖò -->
                <v-stepper-window-item value="4">
                  <v-card class="pa-4" flat>
                    <h3 class="text-h6 mb-4">ÏÑ∏Î∂Ä ÏòµÏÖòÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî</h3>
                    
                    <v-row>
                      <v-col cols="12" md="6">
                        <v-select
                          v-model="contentData.toneAndManner"
                          label="ÌÜ§Ïï§Îß§ÎÑà"
                          variant="outlined"
                          :items="TONE_OPTIONS"
                          item-title="text"
                          item-value="value"
                        />
                      </v-col>
                      
                      <v-col cols="12" md="6">
                        <v-select
                          v-model="contentData.emotionIntensity"
                          label="Í∞êÏ†ï Í∞ïÎèÑ"
                          variant="outlined"
                          :items="EMOTION_INTENSITY"
                          item-title="text"
                          item-value="value"
                        />
                      </v-col>
                      
                      <v-col cols="12" md="6">
                        <v-select
                          v-model="contentData.promotion"
                          label="ÌîÑÎ°úÎ™®ÏÖò Ï†ïÎ≥¥"
                          variant="outlined"
                          :items="PROMOTION_OPTIONS"
                          item-title="text"
                          item-value="value"
                        />
                      </v-col>
                      
                      <!-- SNS ÌîåÎû´Ìèº ÏÑ†ÌÉù (SNS Í≤åÏãúÎ¨ºÏù∏ Í≤ΩÏö∞Îßå) -->
                      <v-col
                        v-if="contentData.type === 'SNS_POST'"
                        cols="12" md="6"
                      >
                        <v-select
                          v-model="contentData.platform"
                          label="Í≤åÏãú ÌîåÎû´Ìèº"
                          variant="outlined"
                          :items="platformOptions"
                          item-title="text"
                          item-value="value"
                        />
                      </v-col>
                    </v-row>
                    
                    <!-- Í∏∞Í∞Ñ ÏÑ§Ï†ï -->
                    <v-row>
                      <v-col cols="12" md="6">
                        <v-text-field
                          v-model="contentData.startDate"
                          label="ÌôçÎ≥¥ ÏãúÏûëÏùº"
                          variant="outlined"
                          type="date"
                        />
                      </v-col>
                      <v-col cols="12" md="6">
                        <v-text-field
                          v-model="contentData.endDate"
                          label="ÌôçÎ≥¥ Ï¢ÖÎ£åÏùº"
                          variant="outlined"
                          type="date"
                        />
                      </v-col>
                    </v-row>
                  </v-card>
                </v-stepper-window-item>

                <!-- Step 5: ÏÉùÏÑ± Í≤∞Í≥º -->
                <v-stepper-window-item value="5">
                  <v-card class="pa-4" flat>
                    <h3 class="text-h6 mb-4">ÏÉùÏÑ±Îêú ÏΩòÌÖêÏ∏†</h3>
                    
                    <v-card
                      v-if="generatedContent"
                      class="pa-4 mb-4"
                      color="blue-grey-lighten-5"
                      variant="tonal"
                    >
                      <h4 class="text-h6 mb-2">{{ generatedContent.title }}</h4>
                      <div class="text-body-1 mb-3" style="white-space: pre-line;">
                        {{ generatedContent.content }}
                      </div>
                      
                      <!-- Ìï¥ÏãúÌÉúÍ∑∏ (SNSÏù∏ Í≤ΩÏö∞) -->
                      <div
                        v-if="generatedContent.hashtags && generatedContent.hashtags.length > 0"
                        class="mb-3"
                      >
                        <v-chip
                          v-for="tag in generatedContent.hashtags"
                          :key="tag"
                          class="mr-1 mb-1"
                          size="small"
                          color="primary"
                        >
                          {{ tag }}
                        </v-chip>
                      </div>
                    </v-card>
                    
                    <!-- Î°úÎî© ÏÉÅÌÉú -->
                    <v-card
                      v-else-if="generating"
                      class="pa-8 text-center"
                    >
                      <v-progress-circular
                        indeterminate
                        color="primary"
                        size="64"
                        class="mb-4"
                      />
                      <p class="text-body-1">AIÍ∞Ä ÏΩòÌÖêÏ∏†Î•º ÏÉùÏÑ±ÌïòÍ≥† ÏûàÏäµÎãàÎã§...</p>
                      <p class="text-body-2 grey--text">Ïû†ÏãúÎßå Í∏∞Îã§Î†§Ï£ºÏÑ∏Ïöî</p>
                    </v-card>
                    
                    <!-- ÏÉùÏÑ± Ïã§Ìå® -->
                    <v-card
                      v-else-if="generationError"
                      class="pa-6 text-center"
                      color="error"
                      variant="tonal"
                    >
                      <v-icon size="48" color="error" class="mb-2">mdi-alert-circle</v-icon>
                      <p class="text-body-1">ÏΩòÌÖêÏ∏† ÏÉùÏÑ±Ïóê Ïã§Ìå®ÌñàÏäµÎãàÎã§</p>
                      <p class="text-body-2">{{ generationError }}</p>
                    </v-card>
                  </v-card>
                </v-stepper-window-item>
                
              </v-stepper-window>
            </v-stepper>
          </v-card-text>
          
          <v-divider />
          
          <!-- Ïï°ÏÖò Î≤ÑÌäº -->
          <v-card-actions class="pa-4">
            <v-btn
              v-if="currentStep > 1"
              color="grey"
              variant="outlined"
              @click="currentStep--"
            >
              Ïù¥Ï†Ñ
            </v-btn>
            
            <v-spacer />
            
            <!-- Îã§Ïùå/ÏÉùÏÑ± Î≤ÑÌäº -->
            <v-btn
              v-if="currentStep < 5"
              color="primary"
              :disabled="!canProceed"
              @click="nextStep"
            >
              {{ currentStep === 4 ? 'AI ÏÉùÏÑ±ÌïòÍ∏∞' : 'Îã§Ïùå' }}
            </v-btn>
            
            <!-- Ï†ÄÏû• Î≤ÑÌäº -->
            <v-btn
              v-if="currentStep === 5 && generatedContent"
              color="success"
              :loading="saving"
              @click="saveContent"
            >
              Ï†ÄÏû•ÌïòÍ∏∞
            </v-btn>
            
            <!-- Ïû¨ÏÉùÏÑ± Î≤ÑÌäº -->
            <v-btn
              v-if="currentStep === 5"
              color="primary"
              variant="outlined"
              :loading="generating"
              @click="regenerateContent"
            >
              Îã§Ïãú ÏÉùÏÑ±
            </v-btn>
          </v-card-actions>
        </v-card>
      </v-col>
    </v-row>
    
    <!-- ÏÑ±Í≥µ Ïä§ÎÇµÎ∞î -->
    <v-snackbar
      v-model="showSuccess"
      color="success"
      timeout="3000"
    >
      ÏΩòÌÖêÏ∏†Í∞Ä ÏÑ±Í≥µÏ†ÅÏúºÎ°ú Ï†ÄÏû•ÎêòÏóàÏäµÎãàÎã§!
    </v-snackbar>
    
    <!-- ÏóêÎü¨ Ïä§ÎÇµÎ∞î -->
    <v-snackbar
      v-model="showError"
      color="error"
      timeout="3000"
    >
      {{ errorMessage }}
    </v-snackbar>
  </v-container>
</template>